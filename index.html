<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>印章排版預覽</title>
  <style>
    :root {
      --stamp-size: 1cm; /* 固定印章邊長為1公分 */
      --border-width: 0.1mm; /* 窄外框 */
      --shift-x: 0cm; /* 初始置中 */
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "新細明體", "PMingLiU", serif;
      background: #f7f7f8;
      color: #111;
    }

    .wrap { max-width: 900px; margin: 24px auto; padding: 16px; }
    h1 { font-size: 20px; margin: 0 0 12px; font-family: "新細明體", serif; }

    .panel { display: grid; grid-template-columns: 1.2fr 1fr; gap: 16px; align-items: start; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 14px; box-shadow: 0 2px 8px rgba(0,0,0,.06); padding: 14px; font-family: "新細明體", serif; }

    input[type="text"] { width: 100%; padding: 10px 12px; font-size: 16px; border: 1px solid #d1d5db; border-radius: 10px; outline: none; font-family: "新細明體", serif; }
    input[type="range"] { width: 200px; }

    button { margin-top: 10px; padding: 8px 16px; font-size: 14px; border: none; border-radius: 8px; background-color: #2563eb; color: white; cursor: pointer; }
    button:hover { background-color: #1d4ed8; }

    .hint { font-size: 12px; color: #6b7280; line-height: 1.5; font-family: "新細明體", serif; }

    .stamp-shell { display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px; }

    .stamp { width: var(--stamp-size); aspect-ratio: 1/1; border: var(--border-width) solid #111; box-sizing: border-box; background: #fff; overflow: hidden; color: #000; position: relative; }

    .stamp-content { position: absolute; inset: 0; transform: scaleX(-1) translateX(var(--shift-x)); transform-origin: center; }

    .layout-2plus1 { display: grid; grid-template-columns: 50% 50%; grid-template-rows: 1fr; }
    .big-char { grid-column: 1 / 2; grid-row: 1 / 2; display: flex; align-items: center; justify-content: center; font-weight: 700; line-height: 1; font-size: 0.58cm; letter-spacing: 0.05cm; font-family: "新細明體", serif; transform: scaleY(1.3); padding: 0 0.12cm; box-sizing: border-box; }
    .rest-col { grid-column: 2 / 3; grid-row: 1 / 2; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.08cm; }
    .rest-char { font-weight: 700; line-height: 1; font-size: 0.45cm; letter-spacing: 0.02cm; font-family: "新細明體", serif; }

    .layout-2x2 { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
    .quad-char { display: flex; align-items: center; justify-content: center; font-weight: 700; line-height: 1; font-size: 0.42cm; letter-spacing: 0.02cm; font-family: "新細明體", serif; }

    .empty-tip { opacity: .6; font-size: 0.2cm; text-align: center; padding: 0.2cm; font-family: "新細明體", serif; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>印章排版預覽（固定 1 公分）</h1>
    <div class="panel">
      <div class="card">
        <input id="nameInput" type="text" placeholder="輸入：王／大明 或 四個字情境（例如：林／志玲）" value="王／大明" />
        <div style="margin-top:10px;">
          <label>左右位置調整（±0.20cm）</label><br>
          <input id="shiftRange" type="range" min="-0.20" max="0.20" step="0.01" value="0.00">
          <span id="shiftValue">0.00cm</span>
        </div>
        <button id="downloadBtn">輸出 JPG</button>
        <p class="hint">規則：<br>1) 斜線（全形／半形）僅作分隔用，不顯示。<br>2) 3字以下：第一字放左半放大，其餘字在右半垂直排。<br>3) <b>4字：自動切換為 2×2 等分版面</b>，四字平均分攤空間。<br>4) 固定印章為 1 公分，內容鏡像顯示（刻章）。<br>5) 可輸出 JPG、左右微調位置。</p>
      </div>
      <div class="card stamp-shell">
        <div id="stamp" class="stamp">
          <div class="empty-tip">請輸入姓名以預覽印章排版</div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const inputEl = document.getElementById('nameInput');
    const stampEl = document.getElementById('stamp');
    const downloadBtn = document.getElementById('downloadBtn');
    const shiftRange = document.getElementById('shiftRange');
    const shiftValue = document.getElementById('shiftValue');

    function normalize(raw) {
      if (!raw) return '';
      return raw.replace(/\s+/g, '').replace(/[\/／]/g, '');
    }

    function make2plus1(chars) {
      const wrap = document.createElement('div');
      wrap.className = 'stamp-content layout-2plus1';
      const big = chars[0] || '';
      const rest = chars.slice(1);
      const bigDiv = document.createElement('div');
      bigDiv.className = 'big-char';
      bigDiv.textContent = big;
      wrap.appendChild(bigDiv);
      const restCol = document.createElement('div');
      restCol.className = 'rest-col';
      rest.forEach(ch => {
        const c = document.createElement('div');
        c.className = 'rest-char';
        c.textContent = ch;
        restCol.appendChild(c);
      });
      wrap.appendChild(restCol);
      return wrap;
    }

    function make2x2(chars) {
      const wrap = document.createElement('div');
      wrap.className = 'stamp-content layout-2x2';
      for (let i = 0; i < 4; i++) {
        const cell = document.createElement('div');
        cell.className = 'quad-char';
        cell.textContent = chars[i] || '　';
        wrap.appendChild(cell);
      }
      return wrap;
    }

    function render() {
      const s = normalize(inputEl.value);
      const chars = s.split('');
      stampEl.innerHTML = '';
      if (chars.length === 0) {
        const tip = document.createElement('div');
        tip.className = 'empty-tip';
        tip.textContent = '請輸入姓名以預覽印章排版';
        stampEl.appendChild(tip);
        return;
      }
      let content;
      if (chars.length === 4) {
        content = make2x2(chars);
      } else {
        content = make2plus1(chars);
      }
      stampEl.appendChild(content);
    }

    function updateShift() {
      const shift = parseFloat(shiftRange.value);
      shiftValue.textContent = `${shift.toFixed(2)}cm`;
      document.documentElement.style.setProperty('--shift-x', `${shift}cm`);
    }

    async function downloadJPG() {
      const canvas = await html2canvas(stampEl, { backgroundColor: '#ffffff', scale: 4 });
      const link = document.createElement('a');
      link.download = '印章預覽.jpg';
      link.href = canvas.toDataURL('image/jpeg', 1.0);
      link.click();
    }

    inputEl.addEventListener('input', render);
    shiftRange.addEventListener('input', updateShift);
    downloadBtn.addEventListener('click', downloadJPG);
    render();
  </script>
</body>
</html>